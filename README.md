# Indonesian Adventure Simulator

Симулятор игровой механики Indonesian Adventure для анализа экономического баланса и прогрессии игры.

## Описание проекта

Данный проект представляет собой инструмент для симуляции и анализа игровой экономики Indonesian Adventure. Система позволяет настраивать различные параметры игровой механики и анализировать их влияние на прогрессию пользователя, экономический баланс и общий геймплей.

## Основные возможности

- **Симуляция игрового процесса**: моделирование поведения игрока с учетом заданной конфигурации
- **Анализ прогрессии**: отслеживание роста заработка, уровня персонажа и других показателей
- **Экономический анализ**: оценка баланса доходов и расходов 
- **Анализ улучшений локаций**: отслеживание времени и порядка улучшений
- **Тапинг-механика**: моделирование активного кликанья игрока
- **Интерактивный дашборд**: наглядный интерфейс для настройки параметров и анализа результатов

## Структура проекта

```
idadv_dash_simulator/
├── assets/                  # Статические ресурсы (CSS, изображения)
├── config/                  # Конфигурационные файлы
│   ├── __init__.py
│   ├── dashboard_config.py  # Конфигурация дашборда
│   └── simulation_config.py # Конфигурация симуляции
├── dashboard/               # Модуль дашборда
│   ├── __init__.py
│   ├── layout.py           # Определение макета дашборда
│   ├── simulation.py       # Коллбеки для симуляции
│   └── callbacks/          # Коллбеки Dash
│       ├── __init__.py
│       ├── economy.py      # Экономический анализ
│       ├── locations.py    # Анализ локаций
│       ├── progression.py  # Анализ прогресса
│       ├── tapping.py      # Анализ тапинга
│       └── workflow.py     # Обработка рабочего процесса
├── models/                 # Модели данных
│   ├── __init__.py
│   ├── config.py          # Структуры конфигурации
│   ├── stats.py           # Структуры статистики
│   └── enums.py           # Перечисления
├── utils/                 # Утилиты
│   ├── __init__.py
│   ├── data_processing.py # Обработка данных
│   ├── economy.py         # Экономические расчеты
│   ├── export.py          # Экспорт данных
│   ├── plotting.py        # Утилиты для графиков
│   └── validation.py      # Валидация конфигурации
├── workflow/              # Логика симуляции
│   ├── __init__.py
│   ├── balance.py         # Баланс пользователя
│   ├── location.py        # Модель локации
│   ├── tapping.py         # Механика тапинга
│   ├── simulation_response.py # Результат симуляции
│   └── workflow.py        # Основная логика симуляции
├── __init__.py
├── requirements.txt       # Зависимости проекта
├── run_dashboard.py       # Запуск дашборда
├── run_simulator.py       # Запуск симулятора в консоли
└── simulator.py           # Основной класс симулятора
```

## Требования

- Python 3.8+
- Dash 2.14.0
- Dash Core Components 2.0.0
- Dash HTML Components 2.0.0
- Dash Table 5.0.0
- Pandas 2.1.2
- Plotly 5.18.0
- Numpy 1.26.1

## Установка и запуск

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Запуск дашборда

```bash
python run_dashboard.py
```

Дашборд будет доступен по адресу http://localhost:8050

### Запуск симуляции в консоли

```bash
python run_simulator.py [опции]
```

#### Параметры командной строки

| Параметр | Описание |
|----------|----------|
| `--base-gold` | Базовое значение золота в секунду |
| `--earn-coefficient` | Коэффициент роста золота |
| `--starting-gold` | Начальное количество золота |
| `--starting-xp` | Начальный опыт |
| `--starting-keys` | Начальное количество ключей |
| `--cooldown-multiplier` | Множитель кулдауна между улучшениями |
| `--checks-per-day` | Количество проверок в день |
| `--algorithm` | Алгоритм симуляции (`sequential` или `first_available`) |
| `--enable-tapping` | Включить механику тапания |
| `--disable-tapping` | Выключить механику тапания |
| `--max-energy` | Максимальный запас энергии для тапания |
| `--tap-speed` | Скорость тапания (тапов в секунду) |
| `--tap-coef` | Множитель золота за тап |
| `--export` | Путь для экспорта результатов в JSON |
| `--verbose` | Подробный вывод |

Пример:
```bash
python run_simulator.py --base-gold 10.0 --earn-coefficient 1.1 --checks-per-day 5 --enable-tapping
```

## Настройка параметров симуляции

### Параметры экономики
- **Базовое значение gold/sec**: основной параметр заработка
- **Коэффициент роста**: влияет на скорость прогрессии
- **Начальные значения**: стартовое количество золота, опыта и ключей

### Параметры локаций
- **Типы редкости**: Common, Rare, Epic, Legendary
- **Уровни улучшений**: стоимость и прирост заработка для каждого уровня
- **Требования к уровню персонажа**: минимальный уровень для открытия

### Параметры тапания
- **Максимальный запас энергии**: влияет на продолжительность тапания
- **Скорость тапания**: количество тапов в секунду
- **Множитель золота**: влияет на доход от тапания

## Дашборд

Дашборд предоставляет следующие функции:

1. **Настройка параметров симуляции**
   - Экономические параметры
   - Частота проверок
   - Множитель кулдаунов
   - Параметры тапинга

2. **Анализ прогресса**
   - Динамика уровня персонажа
   - Изменение ресурсов
   - Ключевые метрики

3. **Экономический анализ**
   - Динамика золота
   - Доходы и расходы
   - ROI улучшений

4. **Анализ локаций**
   - Уровни локаций
   - Стоимость и награды
   - Временная шкала улучшений

5. **Анализ тапинга**
   - Влияние тапинга на доходы
   - Энергетический баланс
   - Оптимизация тапинга

## Функционал экспорта данных

Дашборд поддерживает автоматический экспорт результатов анализа в CSV файлы. При выполнении расчетов следующие таблицы сохраняются в папку `output/`:

1. **События по дням** (`daily_events_*.csv`) - таблица с событиями по каждому игровому дню
2. **Баланс золота** (`gold_balance_*.csv`) - таблица с полной историей изменений баланса золота
3. **История улучшений локаций** (`location_upgrades_history_*.csv`) - подробная история всех улучшений локаций

Файлы сохраняются с временной меткой в имени для отслеживания разных запусков симуляции. Экспорт происходит автоматически при обновлении соответствующих таблиц в дашборде.

## Новые возможности и оптимизации

### Оптимизации производительности
- Кэширование экономических расчетов с использованием `lru_cache`
- Оптимизированные формулы вычислений вместо рекурсии
- Модульная структура для более эффективной загрузки

### Новые аналитические функции
- Расчет ROI (Return on Investment) для улучшений
- Анализ оптимальной последовательности улучшений
- Анализ динамики дохода и прогрессии
- Моделирование механики тапинга с учетом энергии

### Улучшения кодовой базы
- Типизация параметров и возвращаемых значений
- Модульная структура для лучшей расширяемости
- Валидация входных данных и конфигураций

## Рекомендации по использованию

### Для анализа экономики
1. Начните с установки базовых значений экономики (base_gold, earn_coefficient)
2. Используйте вкладку "Экономический анализ" для определения оптимальных параметров
3. Экспортируйте данные для дальнейшего анализа

### Для балансировки
1. Используйте разные алгоритмы симуляции для сравнения результатов
2. Настройте множитель кулдауна для регулирования темпа игры
3. Анализируйте ROI и время окупаемости улучшений

### Для анализа тапинга
1. Включите механику тапинга через настройки дашборда
2. Настройте параметры энергии и скорости тапинга
3. Оцените влияние тапинга на общую экономику и прогрессию

### Для разработчиков
1. Используйте модульную структуру для добавления новых аналитических возможностей
2. Ознакомьтесь с форматом конфигурации в `models/config.py`
3. При добавлении новых функций следуйте принципам существующей кодовой базы 
# Indonesian Adventure Simulator и Dashboard

Проект для симуляции и анализа игровой механики Indonesian Adventure.

## Структура проекта

```
idadv_dash_simulator/
├── assets/                  # Статические ресурсы (CSS, изображения)
├── config/                  # Конфигурационные файлы
│   ├── __init__.py
│   ├── dashboard_config.py  # Конфигурация дашборда
│   └── simulation_config.py # Конфигурация симуляции
├── dashboard/               # Модуль дашборда
│   ├── __init__.py
│   ├── layout.py           # Определение макета дашборда
│   ├── simulation.py       # Коллбеки для симуляции
│   └── callbacks/          # Коллбеки Dash
│       ├── __init__.py
│       ├── economy.py      # Экономический анализ
│       ├── locations.py    # Анализ локаций
│       ├── progression.py  # Анализ прогресса
│       └── workflow.py     # Обработка рабочего процесса
├── models/                 # Модели данных
│   ├── __init__.py
│   ├── config.py          # Структуры конфигурации
│   └── enums.py           # Перечисления
├── utils/                 # Утилиты
│   ├── __init__.py
│   ├── data_processing.py # Обработка данных
│   ├── economy.py         # Экономические расчеты
│   ├── export.py          # Экспорт данных в CSV
│   ├── plotting.py        # Утилиты для графиков
│   └── validation.py      # Валидация конфигурации
├── workflow/              # Логика симуляции
│   ├── __init__.py
│   ├── balance.py         # Баланс пользователя
│   ├── location.py        # Модель локации
│   ├── simulation_response.py # Результат симуляции
│   └── workflow.py        # Основная логика симуляции
├── __init__.py
├── requirements.txt       # Зависимости проекта
├── run_dashboard.py       # Запуск дашборда
├── run_simulator.py       # Запуск симулятора
└── simulator.py           # Класс симулятора
```

## Установка

### Требования
- Python 3.8+
- pip

### Установка зависимостей

```bash
pip install -r requirements.txt
```

## Запуск

### Запуск симулятора

Базовый запуск с настройками по умолчанию:

```bash
python run_simulator.py
```

Запуск с пользовательскими настройками:

```bash
python run_simulator.py --base-gold 10.0 --earn-coefficient 1.1 --checks-per-day 5
```

#### Параметры командной строки

| Параметр | Описание |
|----------|----------|
| `--base-gold` | Базовое значение золота в секунду |
| `--earn-coefficient` | Коэффициент роста золота |
| `--cooldown-multiplier` | Множитель кулдауна между улучшениями |
| `--checks-per-day` | Количество проверок в день |
| `--algorithm` | Алгоритм симуляции (`sequential` или `first_available`) |
| `--export` | Путь для экспорта результатов в JSON |
| `--verbose` | Подробный вывод |

Пример экспорта результатов:

```bash
python run_simulator.py --algorithm first_available --export results/simulation_result.json
```

### Запуск дашборда

```bash
python run_dashboard.py
```

Дашборд будет доступен по адресу http://localhost:8050

## Описание модулей

### Конфигурация (config/)

- **dashboard_config.py** - Настройки интерфейса дашборда, стили, цвета
- **simulation_config.py** - Настройки симуляции, параметры локаций, экономика

### Модели (models/)

- **config.py** - Dataclass-модели для хранения конфигураций
- **enums.py** - Перечисления для симуляции

### Утилиты (utils/)

- **data_processing.py** - Функции для обработки и анализа данных
- **economy.py** - Экономические расчеты (gold/sec, ROI)
- **export.py** - Экспорт данных в CSV
- **plotting.py** - Утилиты для создания графиков
- **validation.py** - Валидация конфигураций и данных симуляции

### Рабочий процесс (workflow/)

- **balance.py** - Баланс ресурсов пользователя
- **location.py** - Модель игровой локации
- **workflow.py** - Логика симуляции игрового процесса

### Дашборд (dashboard/)

- **layout.py** - Определение макета интерфейса
- **simulation.py** - Основные коллбеки симуляции
- **callbacks/** - Обработчики событий по категориям

## Настройка симуляции

Основные параметры симуляции можно настроить в файле `config/simulation_config.py`:

- Количество и уровни локаций
- Параметры экономики (базовый заработок, коэффициент роста)
- Уровни персонажа и требования
- Кулдауны между улучшениями

## Дашборд

Дашборд предоставляет следующие функции:

1. **Настройка параметров симуляции**
   - Экономические параметры
   - Частота проверок
   - Множитель кулдаунов

2. **Анализ прогресса**
   - Динамика уровня персонажа
   - Изменение ресурсов
   - Ключевые метрики

3. **Экономический анализ**
   - Динамика золота
   - Доходы и расходы
   - ROI улучшений

4. **Анализ локаций**
   - Уровни локаций
   - Стоимость и награды
   - Временная шкала улучшений

5. **Анализ темпа игры**
   - Время между улучшениями
   - Периоды стагнации
   - Статистика прогресса 

## Функционал экспорта данных

Дашборд поддерживает автоматический экспорт результатов анализа в CSV файлы. При выполнении расчетов следующие таблицы сохраняются в папку `output/`:

1. **События по дням** (`daily_events_*.csv`) - таблица с событиями по каждому игровому дню
2. **Баланс золота** (`gold_balance_*.csv`) - таблица с полной историей изменений баланса золота
3. **История улучшений локаций** (`location_upgrades_history_*.csv`) - подробная история всех улучшений локаций

Файлы сохраняются с временной меткой в имени для отслеживания разных запусков симуляции. Экспорт происходит автоматически при обновлении соответствующих таблиц в дашборде.

## Новые возможности и оптимизации

### Оптимизации производительности
- Кэширование экономических расчетов с использованием `lru_cache`
- Оптимизированные формулы вычислений вместо рекурсии
- Модульная структура для более эффективной загрузки

### Новые аналитические функции
- Расчет ROI (Return on Investment) для улучшений
- Анализ оптимальной последовательности улучшений
- Анализ динамики дохода и прогрессии

### Улучшения кодовой базы
- Типизация параметров и возвращаемых значений
- Модульная структура для лучшей расширяемости
- Валидация входных данных и конфигураций

### Командная строка
- Расширенные аргументы командной строки для гибкой настройки симуляции
- Экспорт результатов в JSON формат
- Возможность подробного вывода для отладки

## Рекомендации по использованию

### Для анализа экономики
1. Начните с установки базовых значений экономики (base_gold, earn_coefficient)
2. Используйте вкладку "Экономический анализ" для определения оптимальных параметров
3. Экспортируйте данные для дальнейшего анализа

### Для балансировки
1. Используйте разные алгоритмы симуляции для сравнения результатов
2. Настройте множитель кулдауна для регулирования темпа игры
3. Анализируйте ROI и время окупаемости улучшений

### Для разработчиков
1. Используйте модульную структуру для добавления новых аналитических возможностей
2. Ознакомьтесь с форматом конфигурации в `models/config.py`
3. При добавлении новых функций следуйте принципам существующей кодовой базы 